<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Network Information - Vigilance System</title>
    <!-- Use CDN links to ensure CSS loads properly -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            padding-bottom: 20px;
        }
        .node-card {
            border-radius: 8px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }
        .node-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .node-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .node-status {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 5px;
        }
        .node-status.active {
            background-color: #28a745;
        }
        .node-status.inactive {
            background-color: #dc3545;
        }
        .node-status.simulated {
            background-color: #ffc107;
        }
        .algorithm-card {
            border-radius: 8px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }
        .algorithm-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .algorithm-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        .capacity-bar {
            height: 8px;
            border-radius: 4px;
            background-color: #e9ecef;
            margin-top: 5px;
            overflow: hidden;
        }
        .capacity-fill {
            height: 100%;
            background-color: #0d6efd;
            width: 0%;
            transition: width 0.5s ease;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">Vigilance System</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/visualizations">Algorithm Visualizations</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/network">Network Routing</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/network/info">Network Info</a>
                    </li>
                </ul>
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/logout">Logout</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container">
        <h2 class="mb-4">Network Information</h2>

        <div class="row">
            <div class="col-md-8">
                <!-- Network Nodes Overview -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h4>Network Nodes Overview</h4>
                    </div>
                    <div class="card-body">
                        <p>The Vigilance System uses a distributed architecture with multiple network nodes to process video frames. Here's what you need to know about these nodes:</p>

                        <h5 class="mt-4">1. Types of Nodes</h5>
                        <ul>
                            <li><strong>Processing Nodes:</strong> These are the main computational units that process video frames from cameras</li>
                            <li><strong>Camera Nodes:</strong> These represent the video sources (either real cameras or simulated video feeds)</li>
                            <li><strong>Central Node:</strong> The main server that coordinates the distribution of frames</li>
                        </ul>

                        <h5 class="mt-4">2. Node Configuration</h5>
                        <p>The system is configured to use multiple processing nodes:</p>
                        <ul>
                            <li>Each node has an ID (e.g., node_1, node_2, etc.)</li>
                            <li>Each node runs on localhost with different ports (8000, 8001, etc.)</li>
                            <li>Each node has a capacity rating that determines how many frames it can process</li>
                            <li>Nodes can be either real (actual socket connections) or simulated (for testing/demonstration)</li>
                        </ul>
                    </div>
                </div>

                <!-- How Routing Works -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h4>How Routing Works</h4>
                    </div>
                    <div class="card-body">
                        <p>The system uses different routing algorithms to distribute video frames from cameras to processing nodes:</p>

                        <h5 class="mt-4">1. Available Routing Algorithms</h5>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <div class="card algorithm-card">
                                    <div class="card-body text-center">
                                        <i class="bi bi-arrow-right-circle algorithm-icon text-primary"></i>
                                        <h5>Direct Connection</h5>
                                        <p class="mb-0">All traffic goes to a single node. Simplest algorithm but can lead to overloading.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="card algorithm-card">
                                    <div class="card-body text-center">
                                        <i class="bi bi-arrow-repeat algorithm-icon text-success"></i>
                                        <h5>Round Robin</h5>
                                        <p class="mb-0">Distributes frames evenly across all available nodes in a circular pattern.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="card algorithm-card">
                                    <div class="card-body text-center">
                                        <i class="bi bi-graph-down algorithm-icon text-danger"></i>
                                        <h5>Least Connection</h5>
                                        <p class="mb-0">Sends frames to the node with the fewest active connections.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="card algorithm-card">
                                    <div class="card-body text-center">
                                        <i class="bi bi-bar-chart-fill algorithm-icon text-info"></i>
                                        <h5>Weighted</h5>
                                        <p class="mb-0">Distributes frames based on node capacity ratings.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="card algorithm-card">
                                    <div class="card-body text-center">
                                        <i class="bi bi-hash algorithm-icon text-warning"></i>
                                        <h5>IP Hash</h5>
                                        <p class="mb-0">Uses a hash of the camera's IP address to determine which node processes its frames.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="card algorithm-card">
                                    <div class="card-body text-center">
                                        <i class="bi bi-cpu algorithm-icon text-purple"></i>
                                        <h5>YOLOv8 Optimized</h5>
                                        <p class="mb-0">Smart routing optimized for YOLOv8 processing, balancing capacity and load.</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <h5 class="mt-4">2. Routing Process</h5>
                        <ol>
                            <li>When a camera captures a frame, it's sent to the central node</li>
                            <li>The central node uses the selected routing algorithm to determine which processing node should handle the frame</li>
                            <li>The frame is forwarded to the selected node for processing</li>
                            <li>The processing node analyzes the frame (object detection, tracking, etc.)</li>
                            <li>Results are sent back to the central node</li>
                            <li>The central node aggregates results for display and alerting</li>
                        </ol>

                        <h5 class="mt-4">3. Simulation Mode</h5>
                        <ul>
                            <li>If real nodes aren't available or can't be connected to, the system falls back to simulated nodes</li>
                            <li>Simulated nodes mimic the behavior of real nodes but process frames locally</li>
                            <li>This allows the system to demonstrate routing algorithms even without a full network setup</li>
                        </ul>
                    </div>
                </div>

                <!-- Visualizing the Routing -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h4>Visualizing the Routing</h4>
                    </div>
                    <div class="card-body">
                        <p>The network routing visualization shows:</p>
                        <ul>
                            <li><strong>Node Representation:</strong> Each processing node is shown as a circle</li>
                            <li><strong>Camera Connections:</strong> Lines connect cameras to the nodes processing their frames</li>
                            <li><strong>Packet Animation:</strong> Animated dots show data flowing from cameras to nodes</li>
                            <li><strong>Load Indicators:</strong> Node colors indicate their current processing load</li>
                            <li><strong>Statistics:</strong> Real-time metrics show bandwidth, latency, packet loss, and jitter</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <!-- Current Network Status -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h4>Current Network Status</h4>
                    </div>
                    <div class="card-body">
                        <div class="d-flex justify-content-between mb-3">
                            <span>Current Algorithm:</span>
                            <strong id="currentAlgorithm">Direct Connection</strong>
                        </div>
                        <div class="d-flex justify-content-between mb-3">
                            <span>Active Nodes:</span>
                            <strong id="activeNodes">0</strong>
                        </div>
                        <div class="d-flex justify-content-between mb-3">
                            <span>Simulated Nodes:</span>
                            <strong id="simulatedNodes">0</strong>
                        </div>
                        <div class="d-flex justify-content-between mb-3">
                            <span>Total Bandwidth:</span>
                            <strong id="totalBandwidth">0.00 MB/s</strong>
                        </div>
                        <div class="d-flex justify-content-between mb-3">
                            <span>Average Latency:</span>
                            <strong id="avgLatency">0.0 ms</strong>
                        </div>
                    </div>
                </div>

                <!-- Active Nodes -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h4>Active Nodes</h4>
                    </div>
                    <div class="card-body">
                        <div id="nodesList">
                            <!-- Nodes will be populated by JavaScript -->
                            <div class="text-center py-4">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                                <p class="mt-2">Loading nodes...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Use CDN links to ensure JS loads properly -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        $(document).ready(function() {
            // Format algorithm name for display
            function formatAlgorithmName(algorithm) {
                switch(algorithm) {
                    case 'direct': return 'Direct Connection';
                    case 'round_robin': return 'Round Robin';
                    case 'least_connection': return 'Least Connection';
                    case 'weighted': return 'Weighted';
                    case 'ip_hash': return 'IP Hash';
                    case 'yolov8': return 'YOLOv8 Optimized';
                    default: return algorithm;
                }
            }

            // Update network status
            function updateNetworkStatus() {
                $.get('/api/network_status', function(data) {
                    // Update current algorithm
                    $('#currentAlgorithm').text(formatAlgorithmName(data.current_algorithm));

                    // Update node counts
                    $('#activeNodes').text(data.real_nodes);
                    $('#simulatedNodes').text(data.simulated_nodes);

                    // Update network stats
                    $('#totalBandwidth').text(data.bandwidth.toFixed(2) + ' MB/s');
                    $('#avgLatency').text((data.avg_latency * 1000).toFixed(1) + ' ms');

                    // Update nodes list
                    updateNodesList(data.nodes);
                });
            }

            // Update nodes list
            function updateNodesList(nodes) {
                if (!nodes || nodes.length === 0) {
                    $('#nodesList').html('<p class="text-center">No active nodes found.</p>');
                    return;
                }

                let nodesHtml = '';

                nodes.forEach(function(node) {
                    let statusClass = node.simulated ? 'simulated' : (node.active ? 'active' : 'inactive');
                    let statusText = node.simulated ? 'Simulated' : (node.active ? 'Active' : 'Inactive');
                    let capacityPercent = Math.min(100, Math.round(node.load * 100));

                    nodesHtml += `
                        <div class="card node-card">
                            <div class="card-body">
                                <div class="node-header">
                                    <h5 class="mb-0">
                                        <span class="node-status ${statusClass}"></span>
                                        ${node.id}
                                    </h5>
                                    <span class="badge ${node.simulated ? 'bg-warning' : 'bg-success'}">${statusText}</span>
                                </div>
                                <div class="mt-2">
                                    <small class="text-muted">Type: ${node.type || 'Processing'}</small>
                                </div>
                                <div class="mt-2">
                                    <small class="text-muted">Capacity: ${node.capacity.toFixed(1)}</small>
                                </div>
                                <div class="mt-2">
                                    <small class="text-muted">Load: ${(node.load * 100).toFixed(1)}%</small>
                                    <div class="capacity-bar">
                                        <div class="capacity-fill" style="width: ${capacityPercent}%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });

                $('#nodesList').html(nodesHtml);
            }

            // Initial update
            updateNetworkStatus();

            // Update every 3 seconds
            setInterval(updateNetworkStatus, 3000);
        });
    </script>
</body>
</html>
